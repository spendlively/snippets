
///////////////////////////////////////////////////////////
///////Прокинуть порт удаленной машины на локальную////////
///////////////////////////////////////////////////////////
//Прокинуть порт удаленного Redis сервера (remote_ip:6379) на локальную машину (127.0.0.1:9900)
//С заходом на хост
ssh -L 9900:127.0.0.1:6379 ubuntu@remote_ip
//Без захода на хост
ssh -N -L 9900:127.0.0.1:6379 ubuntu@remote_ip
redis-cli -h 127.0.0.1 -p 9900


//Из php (-t -t )
$command = 'ssh -t -t -N -L 9900:127.0.0.1:6379 ubuntu@remote_ip 1>/tmp/out 2>/tmp/err & echo $!';
$result = shell_exec($command);
//-t -t - чтобы принудительно присвоить псевдо-tty, даже если stdin не является терминалом
//в противном случае будет ошибка:
//Pseudo-terminal will not be allocated because stdin is not a terminal.
//echo $! - returns pid

//Ключи ssh
https://www.opennet.ru/man.shtml?topic=ssh&category=1&russian=0



////////////////////////////////////
///////Туннель из сети в мир////////
////////////////////////////////////
//ssh
На хосте 192.168.1.1
ssh -f -N -R 2222:192.168.1.1:22 user@77.77.77.77

На хосте 77.77.77.77:
ssh -p2222 localhost (попадём на хост 192.168.1.1)

//То есть
77.77.77.77 -> 192.168.1.1
(получили доступ с 77.77.77.77 к 192.168.1.1)



//80
На хосте 192.168.1.1
ssh -f -N -R 2080:192.168.1.1:80 user@77.77.77.77

На хосте 77.77.77.77:
wget http://localhost:2080
получим дамп web-ресурса на 192.168.1.1
или
wget http://77.77.77.77:2080





////////////////////////////////////
///////Туннель из мира в сеть///////
////////////////////////////////////
На хосте 192.168.1.1
ssh -f -N -L 4080:192.168.1.1:80 nameuser@77.77.77.77

На своём хосте:
wget http://localhost:4080 (получаем доступ к web-ресурсу 192.168.1.1, который находится за хостом 77.77.77.77)

//То есть
localhost -> 77.77.77.77 -> 192.168.1.1
(получили доступ с localhost через 77.77.77.77 к 192.168.1.1)





///////////////////////////////////////////////////////////////////////////////////////////////
///////Туннель из мира в сеть, если на 77.77.77.77 прокинут порт 22101 на целевой сервер///////
///////////////////////////////////////////////////////////////////////////////////////////////
На хосте 192.168.20.107
ssh -f -N -R 2222:192.168.20.107:22 spendmail@77.77.77.77 -p22101

На целевом хосте (предварительно проверить что открыт порт 2222)
ssh -p2222 spendlively@localhost
