
///////////////////////////////////////////////
///////////////////Пример//////////////////////
///////////////////////////////////////////////
//1. Папка для кэша
sudo mkdir -p /var/cache/nginx
sudo chown -R www-data: /var/cache/nginx

//2. Настройка nginx.conf (секция http)
//sudo nano /etc/nginx/nginx.conf
# directory for cache
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=all:32m max_size=1g;

//3. Настройка sites-available/default (секция location)
//sudo nano /etc/nginx/sites-available/default
proxy_pass http://static-cfg$path_redirect;
proxy_cache all;
proxy_cache_valid 200 1m;

//4. Перезагрузка nginx
sudo nginx -t
sudo nginx -s reload

//5. Мониторинг
ls -al /var/cache/nginx
sudo du -sh /var/cache/nginx



//////////////////////////////////////
////////////Папка для кэша////////////
//////////////////////////////////////
mkdir /var/cache/nginx



//////////////////////////////////////
///////////proxy_cache_path///////////
//////////////////////////////////////
//nginx.conf в секции http
http {
 ...
    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=all:32m max_size=1g;
 ...
}
///var/cache/nginx
 - путь где хранятся файлы кэша

//levels
 - уровни иерархии кэша
 - можно задать от 1 до 3 уровней
 - допускаются значения 1 или 2
 - если levels=1:2, имена файлов в кэше будут такого вида
    - /data/nginx/cache/c/29/b7f54b2df7773722d382f4809d65029c
    - b7f54b2df7773722d382f4809d65029c - md5 от ключа кэширования
    - 1 -> c (последний символ имени файла)
    - 2 -> 29 (два предпоследних символа имени файла)
 - если levels не задан или = “on”, будет использоваться каталог, задаваемый в proxy_temp_path
 - proxy_temp_path - имя каталога для хранения временных файлов с данными, полученными от проксируемых серверов
 - если levels = “off”, то временные файлы будут располагаться непосредственно в каталоге кэша

//keys_zone
 - все активные ключи и информация о данных хранятся в зоне разделяемой памяти
 - имя и размер разделяемой памяти задаются в keys_zone
 - зоны размером в 1 мегабайт достаточно для хранения около 8 тысяч ключей

//max_size=1g
 - максимальный размер всех страниц
 - (размер apps = 324M)
 - при превышении размеров “cache manager” удаляет наименее востребованные данные



////////////////////////////////////
//////////////proxy_cache///////////
////////////////////////////////////
//location
location / {
    proxy_pass http://127.0.0.1:81/;
    proxy_cache all;
    proxy_cache_valid any 1h;
}
//proxy_cache
 - задаёт зону разделяемой памяти, используемой для кэширования
 - proxy_cache=off запрещает кэширование, унаследованное с предыдущего уровня конфигурации

//proxy_cache_valid
 - время кэширования
    - proxy_cache_valid 1m;
 - время кэширования для разных кодов ответа
    - proxy_cache_valid any 10m;
    - proxy_cache_valid 200 302 10m;
