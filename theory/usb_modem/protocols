
/////////////////////////////////////////////
//////////////////ПРОТОКОЛЫ//////////////////
/////////////////////////////////////////////

//Существующие протоколы
//(через запятую перечислены различные названия протокола)
 - RNDIS, HiLink, CdcEthernet
 - NCM, CDC NCM, NDIS, Семейство NCM (Network Control Model)
 - PPP, RAS, Modem
 - MBIM
 - Семейство AT-комманд + PPP
 - ECM, CDC ECM, Семейство ECM (Ethernet Control Model)
 - EEM, CDC EEM, Семейство EEM (Ethernet Emulation Model)
 - Sierra, Проприетарщина типа Sierra и Option
 - Условно-проприетарщина типа QCDM, WMC, QMI


//Сравнение протоколов
https://usblan.belcarra.com/p/protocols.html





/////////////////////////////////////////////
///////////////ВЫБОР ПРОТОКОЛА///////////////
/////////////////////////////////////////////
Если выбирать между PPP, ECM, EEM и NCM, то лучше выбрать NCM.
Именно он реализован в большинстве модемов Huawei.

Иногда одно и то же устройство умеет работать в нескольких различных режимах.
Тогда предпочтение тому или иному протоколу следует отдавать в таком порядке,
по убыванию: проприетарные, QMI, MBIM, NCM, ECM, RNDIS, PPP.





/////////////////////////////////////////////
//////////RNDIS, HiLink, CdcEthernet/////////
/////////////////////////////////////////////
Варианты с PPP и RNDIS — самые тормозные, но в то же время и самые универсальные.
Если вам нужна высокая скорость передачи данных и/или торренты, то они не для вас.
Первый упирается в архитектурные ограничения, второй — в вычислительные мощности модема,
который в таком случае становится уже и не модемом, а очень даже роутером.
И помните, что RNDIS автоматически подразумевает наличие ещё одного NAT-а внутри модема,
наряду с NAT-ом в сети провайдера.

Huawei E3272 (megafon m100-4) понимает PPP, RNDIS (HiLink), и NCM (NDIS).
Для переключения между одним и другим требуется перепрошивка.
Обычно из коробки идёт с NCM-ом.

Модем определяется как сетевой адаптер подключённый к сети, в которой есть роутер с NAT,
DHCP сервер и Web сервер — это всё модем.
Модем сам подключается, сам раздаёт адреса и сам NAT-ит.
В веб интерфейсе можно смотреть уровень сигнала, читать SMS и отправлять USSD запросы.
(не во всех веб интерфейсах это доступно)

Модем фактически превращается в отдельный самостоятельный роутер со DHCP, NATом и эмуляцией сетевого адаптера.
Чтобы его активировать, требуется обновить прошивку с версии 21 до версии 22,
но лично я этого делать не советую. Ибо вычислительной дури мощности у этого "свистка" совсем мало,
и он просто загнётся под мало-мальски серьёзной нагрузкой.

Режим CdcEthernet, эмулирующий порт Ethernet (операторы часто называют такой режим Hilink).
В качестве примера используем модемы Билайн ZTE MF823 и Билайн Huawei E355.
Эти модемы также не требуют настроек и начинают работать сразу.
Но в веб-конфигураторе интернет-центра на экране системный монитор будет отображаться меньше информации.




/////////////////////////////////////////////
////////////////NCM, NDIS////////////////////
/////////////////////////////////////////////
NCM в исполнении Huawei получился весьма чудесным и ни с чем другим не совместимым.
И таки нет, это не QMI, поэтому всякие uqmi и иже с ними отпадают сразу.
Только общение AT-командами через псевдотерминал, только хардкор.
И эти AT-команды, как всегда, тоже мало с чем совместимы и не особо документированы.
На всякий случай, команда установления сеанса связи, которую ещё пришлось поискать: "AT^NDISDUP=1,1".

Модем в ответ на команду "ATI" в поле "Manufacturer" ничего не отдаёт.
Не знаю, возможно, мне просто попался такой экземпляр.
Возможно, его криво перепрошили/разлочили. Но факт остаётся фактом.
Из-за этого идущие в пакете "comgt" для OpenWRT скрипты не понимают с чем имеют дело и вываливаются по ошибке.

Режим NDIS (Network Driver Interface Specification).
В режиме NDIS происходит эмуляция виртуальной сетевой карты.
В веб-конфигураторе на экране системный монитор показываются версия микропрограммы в модеме,
уровень сигнала, базовая станция и т.д.

Модем виден в системе как сетевой интерфейс и COM порт для управления.
Ещё этот режим называют NDIS, тк модем эмулирует стандартный сетевой адаптер,
драйвера на который есть во многих ОС из коробки.
Это наиболее интересный, на мой взгляд, режим работы модема.
Можно получить «белый» IP адрес прямо на сетевой интерфейс системы по DHCP,
пинги не прыгают как в режиме модема, нагрузки на систему не заметно.
В винде в этом режиме он работает практически как WiFi:
в списке доступных сетей показывает сеть оператора, один щелчок, вводим APN и инет работает.





/////////////////////////////////////////////
////////////////////MBIM/////////////////////
/////////////////////////////////////////////
MBIM - самый молодой и перспективным протокол.
В Windows начиная с 8-ки он поддерживается "из коробки",
никаких драйверов устанавливать не требуется: "воткнул и работает".
По этой же причине он не всегда корректно заводится под Linux-ом.
В 2013-м году там было вообще всё очень грустно.
Именно этому протоколу следует отдавать предпочтение при прочих равных.





/////////////////////////////////////////////
////////////////////RAS//////////////////////
/////////////////////////////////////////////
Что касается PPP (он же RAS), то это уже весьма тухлый протокол,
который не даст вам реализовать все преимущества и выжать из LTE полную скорость by design.
Поэтому использовать его я тоже не очень советую.

Режим RAS, эмулирующий последовательный порт RS-232.
Режим RAS (Remote Access Service) предоставляет доступ в режиме модема.
Например, это USB-модем Huawei E392 (МегаФон 4G Модем).
Здесь потребуется ручная настройка – включение модема, выбор оператора и т.д.





//Ссылки
//Про протоколы взаимодействия с 3G/LTE-модемом
https://klink0v.livejournal.com/371655.html

//Huawei E3272 и OpenWRT
https://klink0v.livejournal.com/358761.html

//Описание типов подключений (NDIS, RAS, CdcEthernet) через 3G/4G-модемы
https://help.keenetic.com/hc/ru/articles/213966309-%D0%9E%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5-%D1%82%D0%B8%D0%BF%D0%BE%D0%B2-%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B9-NDIS-RAS-CdcEthernet-%D1%87%D0%B5%D1%80%D0%B5%D0%B7-3G-4G-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BC%D1%8B

//Модем Huawei E3272 (Мегафон M100-4, МТС 824F, 824FT, Билайн E3272 HiLink) — всё что хотелось и не хотелось знать
https://sohabr.net/habr/post/233007/

//Прошивки и WebUi для Huawei E3272
//[ LTE FDD/TDD/UMTS/GSM/EDGE/EVDO DL 150Mbps/ UL 50Mbps @ 20MHz (FDD) DL 112Mbps/ UL 10Mbps @ 20MHz (TDD) ]
https://3ginfo.ru/download58.html

//Настройка OpenWRT с модемами 3G 4G LTE по протоколу NCM (E3272, E3276, E3372, E1550 …)
https://acs-house.ru/openwrt/settings-modems-ncm/






