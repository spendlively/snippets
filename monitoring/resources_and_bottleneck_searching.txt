
///////////////////////////////////////////////////////////////////////
////////////////////////////////ТЕОРИЯ/////////////////////////////////
///////////////////////////////////////////////////////////////////////

//Три основных типа ресурсов:
 - процессор
 - память
 - ввод/вывод (I/O)


//Память
 - физическая
 - виртуальная (физическая + память из области подкачки)


//Физическая память делится между четырьмя пулами:
 - свободная память (free memory)
 - кеш (cache) (свободная память, которая динамически назначается кешу файловой системы,
и может быть выделена повторно по мере необходимости)
 - буфера ввода/вывода (I/O buffers)
 - использованной памяти (памяти, выделеной запущенным в системе процессам)


//Kernel Virtual Memory Manager
 - Менеджер виртуальной памяти ядра может перемещать ожидающие процессы из физической памяти в область подкачки
при возникновении необходимости в свободной физической памяти (в соответствии в текущими настройками в /proc/sys/vm/)
 - Если страница памяти, находящаяся в области подкачки, должна быть загружена для исполнения,
менеджер виртуальной памяти перемещает её обратно в физическую память


//Ввод/вывод
 - дисковый I/O
 - сетевой I/O


//Процессы могут находиться в одном из двух возможных состояний
1. исполнение (running)
2. ожидание (sleeping)
 - израсходовали выделенное процессорное время
 - блокированы (ожидают выделения не доступных в данный момент ресурсов)
 - Если ожидающий (sleeping) процесс перемещён из основной памяти в область подкачки (paged out),
он может находиться в третьем состоянии: "готов к исполнению но жду возврата в основную память
(ready to run but waiting to be paged in)



///////////////////////////////////////////////////////////////////////
////////////////////////////ПОИСК УЗКИХ МЕСТ///////////////////////////
///////////////////////////////////////////////////////////////////////

//vmstat
//Procs
 - (r) - количество процессов в состоянии исполнения
 - (b) - количество процессов в состоянии блокировки
//Memory
 - (swpd) - количество использованной памяти в областях подкачки
 - (free) - количество сободной памяти
 - (buff) - количество использованной памяти под буфера
 - (cache) - количество использованной памяти под кеш файловой системы
//Swap
 - (si - swapped in) - количество страниц помещённых в область подкачки в секунду
 - (so - swapped out) - количество страниц извлечённых из подкачки в секунду
//IO
 - (bi) - количество блоков, полученных от блокового устройства в секунду
 - (bo) - количество блоков, посланных блоковому устройству в секунду
//System
 - (in) - количество прерываний в секунду
 - (cs) - количество переключений контекста в секунду
//CPU
 - (us) - процент полного процессорного времени, проведённого в "user space"
 - (sy) - процент полного процессорного времени, проведённого в "kernel space"
 - (id) - процент полного процессорного времени, проведённого в "idle"
 - (wa) - в ожидании ввода/вывода


//Интерпретация vmstat
//1. Процессор
 - большое количество процессов в состоянии исполнения (r)
 - необходимо или увеличить количество процессоров или заменить процессор на более быстрый,
так как процессы постоянно ждут, пока освободится процессор.

//2. Память
 - количество используемой памяти в области подкачки большое,
свободной и используемой под кеш памяти - маленькое,
наблюдается постоянная активность по перемещению страниц из/в область подкачки
 - система испытывает недостаток памяти

//3. Ввод/вывод
 - большое количество процессов, находящихся в блокированном состоянии(b),
таймер ожиданий процессора (wa) имеет большие значения,
количество операций ввода/вывода (bi/bo) постоянно имеет большое значение
 - операции ввода/вывода - узкое место системы
 - iostat -x 5 (диск)
 - netstat -ic (сеть)


//iostat -x 5
//%util
 - показывает какой процент времени процессора используется для обслуживания запросов к устройству
//await
- время ожидания, среднее время, которое идёт на ожидание выполнения запроса
//svctm
- время обслуживания, которое является временем, необходимым устройству для обслуживания запросов
//Высокое время ожидания, обслуживания и процент от использования указывают,
что устройство слишком медленно для текущей нагрузки


//netstat -ic
 - позволит проследить количество трафика в секунду через каждый сетевой интерфейс.
 - как и в vmstat и iostat, первая строчка показывает обобщённые результаты,
накопленные с момента загрузки системы, следующие строчки показывают статистику
через каждую секунду


//sysdig
 - мощная открытая утилита позволяет получать очень подробную инфорацию о происходящем в системе
