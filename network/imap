
IMAP - Internet Message Access Protocol

IMAP1 - 1986г.
IMAP2 - 1988г.
IMAP3 - 1991г.
IMAP4 - 1994г.
IMAP5 - 1986г. - последние изменения


//Описание
 - предназначен для чтения почты из хранилища сообщений
 - письма постоянно хранятся на сервере
 - поддерживает синхронизацию с сервером для переписывания писем с сервера
 - запрос писем по заданному шаблону
 - IMAP работает в текстовом режиме запрос-ответ
 - IMAP позволяет выполнить несколько команд одновременно
    - клиент может не дожидаться ответа и послать второй запрос
        - поиск письма в большом ящике где много писем
        - массовое обновление писем
    - чтобы отличать команды используются идентификаторы (тэги)
        - Виды тегов: А0001, А0002, ...
        - Команда должна начинаться с тега
        - Ответ сервера включает тег
 - (+) несколько клиентов
 - (+) все клиенты видят одно и то же состояние почтового ящика
 - (+) поддерживает несколько почт.ящиков (папок) и их вложенность
 - (+) письма можно перемещать между папками
 - папка по умолчанию папка INBOX
 - поддерживает флаги (токены) о прочтении и т.д.
 - (-) более сложен по ставнению с POP3
 - (-) расходуется место на сервере для почтовых ящиков

//Стек TCP/IP
 - Прикладной: HTTP, SMTP, POP3, IMAP, DNS, FTP
 - Транспортный: TCP, UDP
 - Сетевой: IP, ICMP
 - Сетевых интерфейсов: ETHERNET, WIFI, DSL


//Транспортные протоколы
 - TCP


//Порты
 - 143


//Флаги IMAP
 - системные (начинаются с \)
    - \Seen - сообщение было просмотрено
    - \Answered - на сообщение был отправлен ответ
    - \Flagged - у сообщения повышенная важность
    - \Draft - письмо является черновиком
    - \Deleted - пометка на удаление
    - \Recent - сообщение новое (при предыдущем подключении его не было)
 - пользовательские (НЕ могут начинаться с \)
    -


//При работе по IMAP клиент проходит 4 состояния
 - Клиент не аутентифицирован (Not Authenticated)
    - только что подключится к серверу
    - необходимо ввести логин и пароль
    - либо пройти аутентификацию другим способом
 - Клиент аутентифицирован (Authenticated)
    - клиент прошел аутентификацию (еще не выбрал папку)
 - Папка выбрана (Selected)
    - выбрана папка на сервере с которой он будет работать
    - можно выполнять действия
 - Выход (Logout)
    - разрыв соединения


//Ответ IMAP состоит из 2х частей
 - Статус
    - OK - команда выполнена успешно
    - NO - при выполнении команды произошла ошибка
    - BAD - клиент отправил неправильную команду или аргументы
 - Поясняющее сообщение


//Команды IMAP
 - LOGIN tom passme - аутентификация
 - LIST "" "*" - получить список всех папок
 - SELECT INBOX - выбор папки из которой читать письма
 - FETCH 1:* FLAGS - просмотр какие письма есть на сервере
    - 1:* - номер письма либо диапазон через :
    - FLAGS - указание чтобы хотим посмотреть флаги
 - FETCH 180 BODY[] - просмотр тела письма №1
 - STORE 1 +FLAGS \Deleted - пометить письмо 1 на удаление
 - EXPUNGE - удалить все помеченные для удаления письма (иначе удалены не будут)
 - LOGOUT - завершить содинение
 Другие команды:
 - CREATE/DELETE/RENAME/STATUS - команды для работы с папками
 - COPY/MOVE - команды для перемещения писем
 - SEARCH - поиск писем
 - CLOSE - закрытие папки


//Пример сеанса чтения писем:
A0001 LOGIN tom passme
    A0001 OK user logged in
A0002 LIST "" "*"
    * LIST (\HasChildren) "/" "INBOX"
    * LIST (\HasNoChildren) "/" "INBOX/Drafts"
    * LIST (\HasNoChildren) "/" "INBOX/Junt"  //спам
    * LIST (\HasNoChildren) "/" "INBOX/Sent"
    * LIST (\HasNoChildren) "/" "INBOX/Trash"
    A0002 OK Completed
A0003 SELECT INBOX
    //сервер показывает доступные флаги
    * FLAGS (\Answered \Flagged \Draft \Deleted \Seen $Forwarded Junk NonJunk)
    ...
    A0003 OK Completed
A0004 FETCH 1:* FLAGS
    * 1 FETCH (FLAGS (\Seen))
    ...
    A0004 OK Completed
A0005 FETCH 1 BODY[]
    * флаги
    тело письма
    * A0005 OK Completed
A0006 STORE 1 +FLAGS \Deleted
    ...
    A0006 OK Completed
A0007 EXPUNGE
    A0007 OK Completed
A0008 LOGOUT
    A0008 OK Completed
