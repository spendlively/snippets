
Кластер
 - база данных


Табличное пространство
 - каталог в фс в котором в виде файликов хранятся объекты
 - объекты (таблица, индекс, ...) состоят из 2-3 или больше файлов, т.к. макс файл 1 Гб
 - есть спец глобальные табличные пространства, которые видны всем базам данных,
например чтобы хранить список баз данных


Буферный кэш
 - данные сначала читаются в бк
 - массив буферов
 - каждый буфер содержит страницу (8 кб) + доп информацию
 - виден всем процесам и защищен блокировками


Транзакции
 1. Атомарность - все или ничего
 2. Согласованность - целостность данных
 3. Изоляция - от других транзакций, SQL предлагает 4 уровня изоляции, реализовано с 2 по 4
 4. Долговечность - даже после сбоя
Первые 3 свойства тесно связаны, в postgr реализуются MVCC - многоверсионность
4 реализуется журналом упреждающей записи (WAL - write ahead log)


WAL - write ahead log
 - файлы по 16 мб
 - попадает на диск гарантированно до записи/изменения самих данных
 - wal writer - процесс, записывающий wal
 - старые файлы архивируются процессом wal archiver


MVCC
 - механизм многоверсионности
 - каждая транзакция работает со своим снимком (копия страницы)
 - в таблицу даравляются новые версии связанные ссылками со старыми данными
 - периодически появляется процесс vacuum и вычищает ненужные версии строк


Блокировки
 - в итоге получается следующая схема
 - чтение не блокирует чтение и изменение
 - изменение не блокирует чтение
 - единственная блокировка - изменение блокирует изменение в одной и той же строке
 - блокировки в postres на уровне строк


Этапы обработки запросов
 - parser - разобр запроса
 - rewriter - переписывание запроса
 - planner - оптимизация запроса
 - executor - выполнение запроса


Расширяемость
 - заложена изначально заложена в архитектуре
 - можно создать свой тип даннх
 - можно создать функции которые будут с ним работать (на самых разных языках пр)
 - можно создать операторы для своего типа данных
 - свои индексы
 - свои обертки сторонных данных (FDW) - например для чтения даннх извне


